#!./env/bin/python
import requests
import time
import grequests
from docopt import docopt

def file_len(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1


def main(file, url, async, verbose):
    f = open(file, 'r')
    num_lines = file_len(file)
    start_time = time.time()
    count = 0

    if verbose:
        print "[+] Testing URL's ".format(num_lines)
urls = []
    for line in f:
        line = line.rstrip('\n')
        formated_url = url.format(line)
        urls.append(formated_url)

    if async:
        rs = (grequests.get(u) for u in urls)
        responses = grequests.map(rs)
        for response in responses:
            if response.status_code != 404:
                print response.url + " : " + str(response.status_code)
                count += 1
    else:
        for url in urls:
            r = requests.get(url, verify=False)
        if r.status_code != 404:
                print  "[*] " + r.url + " : " + str(r.status_code)
                count += 1
        else if response.status_code == '401' or == '403':
            print response.url + "Access Denied or unauthorized access" 
            count += 1
       

    if verbose:
        if count == 0:
            print "[-] No admin URLS were found. Either the txt file does not contain the appropriate url extension or the admin pannel is hidden" 
        else:
            print "Found urls".format(count)

        print "Checked {} different urls in {} seconds\n".format(num_lines, time.time() - start_time)


if __name__ == '__main__':
    init()
    arguments = docopt(__doc__, version="1.0")
    main(arguments['<password_file>'], arguments['<url>'], arguments['--<async>'], arguments ['<--verbose>'])
