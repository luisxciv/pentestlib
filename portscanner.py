import optparse
from threading import Thread
from socket import *
################################
def connscan(tgtHost, tgtPorts):
    try:
        connskt = socket(AF_INET, SOCK_STREAM)
        connskt.connect((tgthost, tgtport))
        connskt.send('Hello\r\n')
        results = connskt.recv(100)
        print
        '%d/tcp open' % tgtport
        print
        'Port response' + str(results)
        connskt.close()
    except:
        print
        '%d/tcp closed' % tgtport
def portscan(tgthost, tgtPorts):
    try:
        tgtip = gethostbyname(tgthost)
    except:
        print('could not get host by name')
        return
    try:
        tgtname = gethostbyaddr(tgtip)
        print('scan results for' + tgtname[0])
    except:
        print('could not get host by ip')
    setdefaulttimeout(1)
    for tgtport in tgtPorts:
        t = Thread(target=connscan, args=(tgthost,tgtPorts))
        t.start()

def main():
    parser = optparse.OptionParser('usage %prog -H' +\
                               '<target_host> -p <target_port')
    parser.add_option('-H', dest='tgthost', type='string', \
                  help = 'specify target port')
    parser.add_option('-p', dest='tgtport', type='int', \
                  help = 'specify port number')
    tgthost = optparse.Option.tgthost
    tgtport = optparse.Option.tgtport
    if (tgthost == None) or (tgtport == None):
     print
    parser.usage
    exit(0)
    portscan(tgthost, tgtport)

    if __name__ == '__main__':
        main()